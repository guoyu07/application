<?php
/**
 * @package   spiralFramework
 * @author    Anton Titov (Wolfy-J)
 * @copyright Â©2009-2011
 */

namespace application\controllers;
use application\classes\FacebookQuery;
use application\models\Login;
use application\models\odm\cms\Page;
use application\models\odm\cms\Piece;
use application\models\odm\Moment;
use application\models\odm\Post;
use application\models\odm\posts\Comment;
use application\models\odm\Seller;
use application\models\odm\User;
use application\models\odm\users\Session;
use application\models\odm\users\UserKeeper;
use spiral\classes\rest\Query;
use spiral\core\Controller;
use spiral\core\image\Object;
use spiral\core\Model;
use spiral\core\ODM;
use spiral\core\Request;
use spiral\core\Storage;
use spiral\core\View;
use spiral\helpers\FileHelper;
use spiral\helpers\StringHelper;

/**
 * Root
 *
 * @author   Anton Titov (Wolfy-J)
 * @category Controllers
 */
class Root extends Controller
{
    /**
     * Basic action.
     *
     * @return string
     */
    public function actionIndex()
    {
        foreach (Piece::find(array(
            '$and' => array(
                array('caption' => 'homepage2'),
                array('$or' => array(array('name' => 'homepage1'), array('name' => 'homepage2'), array('name' => new \MongoRegex("/home.*/"))))
            )
        )) as $piece)
        {
            // dump($piece->getFields());
        }
dump(date('d m y',1381255200));
        $post = Post::findByID('524d9b255abe0b9417000000');

        if (!$uKeeper = UserKeeper::findOne(array('keeperPass' => 'pwd')))
        {
            return 'not found';
        }
        $post->addComment($post->_id, $uKeeper, '12123w');
    // dump($post);
       //$post->save();
        //dump($post->getErrors());
        dump($post->getFields());

        /*foreach ($uKeeper->posts() as $post)
        {
            dump($post->authors->find('id', $uKeeper->_id)->getFields());
            dump($post->getFields());
        }*/

        // $uKeeper->publicName='Valentin';
        //  $post->addAuthor($uKeeper);
        //$post->users = $uKeeper;
        //$post->users = $uKeeper;
        //  $post->save();
        //  dump($post->getFields());

        return $this->view->render('home');
    }
}